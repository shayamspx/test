{{ 'slick.min.css' | asset_url | stylesheet_tag }}
{{ 'slick-theme.min.css' | asset_url | stylesheet_tag }}
{{ 'custom-product-slider.css' | asset_url | stylesheet_tag }}

<div class="product-slider-main">
  <div class="page-width product-slider">
    <div class="product-slider-inner">
      {% assign featured_collection = collections[section.settings.collection] %}
      <div class="slider-heading">
        <h2>{{ section.settings.title }}</h2>
        <a href="{{ featured_collection.url }}">View All</a>
      </div>
      <div class="slider-listing" style="display:none">
        {% assign product_limit = section.settings.limit_product %}
        {% for product in featured_collection.products limit: product_limit %}
          <div class="product-block">
            <div class="product-block-inner">
              <img width="100" height="auto" src="{{ product.featured_image | img_url: '220x' }}" >
              <a href="{{ product.url }}">{{ product.title }}</a>
              <p>{{ product.price | money }}</p>
              {% if product.variants.size > 1 %}
                <a class="atc-button" href="{{ product.url }}">Select Option</a>
              {% else %}
                <button onclick='sliderATC("{{ product.handle }}",{{ product.selected_or_first_available_variant.id }})'>Add to Cart</button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script src='{{ "slick.min.js" | asset_url }}'></script>

<script>
  
  $(document).click(function(e){
    var container = $("#atc_popup");
    if (!container.is(e.target) && container.has(e.target).length === 0) 
    {
	  container.hide();
      
    }
  });
  function sliderATC(productHandle,variantID){
    
    $.getJSON(window.Shopify.routes.root + `products/${productHandle}.js`, function(product) {
        let formattedPrice = Shopify.formatMoney(product.price, '{{ shop.money_with_currency_format }}')
        $("#pop_title").html(product.title);
        $("#pop_img").attr("src",product.featured_image);
        $("#pop_price").html(formattedPrice);
      	$("#atc_popup").show();
        $("body").addClass("fixed-body");
    });
    $.ajax({
      type: 'POST',
      url: '/cart/add.js',
      data: {
        quantity: 1,
        id: variantID
      },
      dataType: 'json', 
      success: function (data) { 
        cartUpdate();
       } 
       });
  }

  function cartUpdate(){
    $.ajax({
        type: 'GET',
        dataType: 'json',
        url: '/cart.json',
        success: function(cart){
            var cartCount = cart.item_count;
            if(cart.item_count > 0){
              $("#CartCount").removeClass("hide");
            }
            $('#CartCount span').html(cartCount);
        }
    });
  }

  $(document).ready(function(){
      $(".slider-listing").show();
  });
  $('.slider-listing').slick({
    dots: false,
    infinite: true,
    speed: 300,
    slidesToShow: 4,
    slidesToScroll: 1,
    responsive: [
      {
        breakpoint: 1024,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 1,
          infinite: true,
          dots: false
        }
      },
      {
        breakpoint: 768,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 1
        }
      },
      {
        breakpoint: 550,
        settings: {
          slidesToShow: 1,
          slidesToScroll: 1,
          dots: true
        }
      }
    ]
  });
 
  
</script>

{% schema %}
  {
    "name": "Custom Product Slider",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "New Arrivals"
      },
	    {
        "type": "collection",
        "id": "collection",
        "label": "Collection"
      },
      {
        "type": "range",
        "id": "limit_product",
        "min": 5,
        "max": 16,
        "step": 1,
        "unit": "px",
        "label": "Show Product",
        "default": 8
      }
	  ],
    "presets": [
      {
        "name": "Custom Product Slider"
	    }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}





